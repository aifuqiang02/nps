# NPS/NPC 完整开发与部署指南

## 1. 开发环境配置
### 1.1 Windows环境
```powershell
# 使用Chocolatey安装工具链
Set-ExecutionPolicy Bypass -Scope Process -Force
iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# 安装必要工具
choco install git make mingw golang -y
[Environment]::SetEnvironmentVariable("GOPATH", "$env:USERPROFILE\go", "Machine")

# 验证安装
go version
git --version
make --version
gcc --version
```

## 2. 开发环境运行
### 2.1 启动服务端
```powershell
# 开发模式运行服务端
go run cmd/nps/nps.go -config=conf/nps.conf -debug=true
```

### 2.2 运行客户端
```powershell
# 开发模式运行客户端
go run cmd/npc/npc.go -server=127.0.0.1:8024 -vkey=test123 -type=tcp -debug=true
```

## 3. 代码编译
### 2.1 使用构建脚本
```bash
# 执行构建脚本 (需要Git Bash环境)
./build_gitbash.sh
```

### 2.2 脚本功能说明
该脚本自动完成以下操作：
1. 编译服务端(nps)和客户端(npc)
2. 生成Windows和Linux版本
3. 自动处理依赖和交叉编译

## 3. 服务部署
### 3.1 服务端配置
```ini
# conf/nps.conf 关键配置示例
appname = nps
http_proxy_ip=0.0.0.0
http_proxy_port=80
https_proxy_port=443
bridge_port=8024
public_vkey=your_public_key
```

### 3.2 客户端连接
```powershell
# Windows客户端
.\npc.exe -server=your_server_ip:8024 -vkey=your_vkey -type=tcp

# Linux客户端
./npc -server=your_server_ip:8024 -vkey=your_vkey -type=tcp
```

## 4. 系统集成
### 4.1 Windows服务
```powershell
# 使用NSSM创建服务
nssm install NPS "D:\path\to\nps.exe"
nssm set NPS AppParameters "-config=conf\nps.conf"
nssm start NPS
```

### 4.2 性能调优
```ini
# 高并发配置
max_conn=10000
flow_limit=1000
timeout=60
p2p_ip_limit=100
```

## 5. 常见问题
### 5.1 端口冲突
```powershell
# 检查端口占用
netstat -ano | findstr "80"
taskkill /PID [pid] /F
```

### 5.2 连接问题
```ini
# 客户端配置检查
log_level=7  # 开启调试日志
